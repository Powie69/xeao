import discord
from discord.ext import commands
from flask import Flask, render_template_string
import threading

# Discord bot setup
intents = discord.Intents.default()
bot = commands.Bot(command_prefix="!", intents=intents)
bot_status = {"status": "Offline"}  # Shared variable to track bot status

# Flask app setup
app = Flask(__name__)

# HTML template
html_template = """
<!DOCTYPE html>
<html>
<head>
    <title>Bot Status</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        .status {
            font-size: 24px;
            font-weight: bold;
        }
        .online {
            color: green;
        }
        .offline {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Discord Bot Status</h1>
    <p class="status {{ status_class }}">{{ status }}</p>
</body>
</html>
"""

@app.route("/")
def status_page():
    status = bot_status["status"]
    status_class = "online" if status == "Online" else "offline"
    return render_template_string(html_template, status=status, status_class=status_class)

# Start Flask server in a separate thread
def run_flask():
    app.run(host="0.0.0.0", port=5000)

# Discord bot events
@bot.event
async def on_ready():
    print(f"{bot.user} is online!")
    bot_status["status"] = "Online"

@bot.event
async def on_disconnect():
    print(f"{bot.user} is offline!")
    bot_status["status"] = "Offline"

if __name__ == "__main__":
    # Run Flask server in a thread
    flask_thread = threading.Thread(target=run_flask)
    flask_thread.start()

    # Run the Discord bot
    bot.run("MTMyMzI2OTM0NjkzMTUwNzI3MA.GGH0mA.QSgTBr1FF9ZmPx_2FrDwKm8eR3llHO8yp-4kvw")
